<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CSL PRO V75 (FIXED)</title>
<style>
/* v75 FIXED CSS */
:root { --bg:#05070a; --card:#0f172a; --text:#e2e8f0; --accent:#22c55e; --border:#1e293b; --err:#ff0055; }
body { background:var(--bg); color:var(--text); font-family:sans-serif; margin:0; padding-bottom:80px; }
.nav { padding:15px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.logo { font-weight:900; color:#fff; }
.grid { display:grid; gap:10px; padding:15px; }
.card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:15px; }
.card.live { border-color:var(--accent); }
.match { display:flex; justify-content:space-between; align-items:center; margin-top:10px; }
.team { display:flex; align-items:center; gap:8px; width:40%; font-size:14px; }
.team.away { justify-content:flex-end; }
.score { font-size:24px; font-weight:bold; color:var(--accent); }
.loading { text-align:center; padding:50px; color:#666; }
.error-box { color:var(--err); padding:20px; text-align:center; border:1px solid var(--err); margin:20px; border-radius:10px; }
.tabs { display:flex; justify-content:center; gap:20px; margin:15px 0; border-bottom:1px solid var(--border); }
.tab { padding:10px; cursor:pointer; color:#94a3b8; }
.tab.active { color:var(--accent); border-bottom:2px solid var(--accent); }
</style>
</head>
<body>
<div class="nav">
    <div class="logo">CSL PRO <span style="font-size:10px;color:#666">V75</span></div>
    <div id="status-ind" style="font-size:12px;color:var(--accent)">‚óè</div>
</div>

<div class="tabs">
    <div class="tab active" onclick="setTab('live')" id="t-live">LIVE</div>
    <div class="tab" onclick="setTab('up')" id="t-up">UPCOMING</div>
    <div class="tab" onclick="setTab('std')" id="t-std">STANDINGS</div>
</div>

<div id="app">
    <div class="loading">CONNECTING TO DATA SOURCE...</div>
</div>

<script>
window.onerror = function(msg, url, line) {
    document.getElementById('app').innerHTML = `<div class="error-box"><b>JS ERROR:</b><br>${msg}<br>Line: ${line}</div>`;
};

let DATA = { matches: [], standings: {} };
let TAB = 'live';

async function init() {
    try {
        const t = Date.now();
        let res = await fetch('data.json?t=' + t);
        if(!res.ok) throw new Error("HTTP "+res.status);
        let text = await res.text();
        try {
            DATA = JSON.parse(text);
        } catch(e) {
            throw new Error("JSON PARSE FAIL: " + text.substring(0,50));
        }
        render();
    } catch(e) {
        document.getElementById('app').innerHTML = `<div class="error-box"><b>DATA FETCH ERROR:</b><br>${e.message}</div>`;
    }
}

function getName(obj) {
    if(!obj) return "Unknown";
    if(typeof obj === 'string') return obj; // Backward compat
    return obj['sc'] || obj['en'] || "Unknown";
}

function setTab(t) { TAB=t; document.querySelectorAll('.tab').forEach(e=>e.className=`tab ${e.id==='t-'+t?'active':''}`); render(); }

function render() {
    const app = document.getElementById('app');
    app.innerHTML = '';

    // STANDINGS
    if (TAB === 'std') {
        if (!DATA.standings || Object.keys(DATA.standings).length === 0) {
            app.innerHTML = '<div class="loading">NO STANDINGS DATA</div>';
            return;
        }
        let html = '';
        for(let code in DATA.standings) {
            html += `<h3 style="margin-left:15px;color:#94a3b8">${code}</h3><div class="card" style="margin:0 15px 15px">`;
            DATA.standings[code].forEach((r, i) => {
                if(i>=5) return; // Show top 5 only for summary
                html += `<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid #333;font-size:13px">
                    <span>${r.pos}. ${getName(r.team)}</span><span>${r.points}pts</span>
                </div>`;
            });
            html += '</div>';
        }
        app.innerHTML = html;
        return;
    }

    // MATCHES
    let list = DATA.matches || [];
    // Filter
    list = list.filter(m => {
        let st = m.statusRaw;
        if (TAB==='live') return ['IN_PLAY','PAUSED','HT','LIVE'].includes(st);
        if (TAB==='up') return ['TIMED','SCHEDULED','UPCOMING'].includes(st);
        return false;
    });
    
    // Sort
    list.sort((a,b) => (a.priority||99) - (b.priority||99));

    if(list.length === 0) {
        app.innerHTML = '<div class="loading">NO MATCHES FOUND</div>';
        // Debug info
        app.innerHTML += `<div style="font-size:10px;text-align:center;color:#444">Total records: ${DATA.matches.length}<br>View: ${TAB}</div>`;
        return;
    }

    list.forEach(m => {
        let card = document.createElement('div');
        card.className = `card ${['IN_PLAY','LIVE'].includes(m.statusRaw)?'live':''}`;
        
        let h = getName(m.home);
        let a = getName(m.away);
        let s = m.score || "0-0";
        let st = getName(m.status);

        card.innerHTML = `<div style="font-size:12px;color:#999;display:flex;justify-content:space-between"><span>${getName(m.league)}</span><span>${st}</span></div>
        <div class="match">
            <div class="team">${h}</div>
            <div class="score">${s}</div>
            <div class="team away">${a}</div>
        </div>`;
        app.appendChild(card);
    });
}

init();
setInterval(init, 30000);
</script>
</body>
</html>
